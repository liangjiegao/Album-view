<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="./layui/css/layui.css">

    <style>

        .item{
            margin-top: 20px;
        }
        .head{
            width: 50px;
            height: 50px;
        }
        .info_div{
            margin-top: 10px;
        }
        .img{
            width: 100%;
            max-height: 400px;
        }
        .up_comment{
            position: absolute;
            right: 0;
            bottom: 0;
        }
        .up{
            float: left;
        }
        .comment{
            float: left;
            margin-left: 10px;
        }
        .time{
            margin-top: 10px;
        }
        .up_list{
            margin-top: 10px;
            padding: 2px;
        }
        .up_list ul{
            list-style:none;
            float: left;
        }
        .up_list li{
            float: left;
        }
        .up_list i{
            float: left;
            padding-right: 5px;
        }
        .comment_list {
            padding: 5px;
            margin-top: 5px;
        }
        .img_group_div{
            margin-top: 10px;
        }
    </style>

</head>
<body>

    <div class="layui-container">

        <div class="layui-col-md8">

            <div class="layui-col-md12">
                <div class="layui-tab layui-tab-brief " lay-filter="docDemoTabBrief">
                    <ul class="layui-tab-title layui-col-md3">
                        <li class="layui-this">朋友</li>
                        <li>全部</li>
                    </ul>
                    <div class="layui-tab-content layui-col-md12">
                        <div class="layui-tab-item layui-show friend_list" id="friend_list">

<!--                            <div class="layui-col-md12 item">-->

<!--                                <div class="layui-col-md1 head_div">-->

<!--                                    <img src="微信图片_20200131140138.jpg" class="head">-->

<!--                                </div>-->
<!--                                <div class="layui-col-md6 nickname_div">-->
<!--                                    <span>武大郎</span>-->
<!--                                </div>-->
<!--                                <div class="layui-col-md6 info_div">-->
<!--                                    <span>一个人抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗抗</span>-->
<!--                                </div>-->
<!--                                <div class="layui-col-md5 layui-col-md-offset1">-->
<!--                                    <div class="layui-col-md11">-->
<!--                                        <img src="微信图片_20200131140138.jpg" class="img">-->

<!--                                    </div>-->
<!--                                    <div class="up_comment">-->
<!--                                        <div class="layui-icon layui-icon-praise up"></div>-->
<!--                                        <div class="layui-icon layui-icon-reply-fill comment"></div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="layui-col-md11 layui-col-md-offset1 time">-->
<!--                                    15分钟前-->
<!--                                </div>-->
<!--                                <div class="layui-col-md6 layui-col-md-offset1 layui-bg-gray up_list">-->
<!--                                    <ul>-->
<!--                                        <i class="layui-icon layui-icon-heart-fill up_list_icon"></i>-->
<!--                                        <li>武松</li>-->
<!--                                        <li>，金莲</li>-->
<!--                                        <li>，西门庆</li>-->

<!--                                    </ul>-->
<!--                                </div>-->
<!--                                <div class="layui-col-md6 layui-col-md-offset1 layui-bg-gray comment_list">-->
<!--                                    <div>-->
<!--                                        <ul>-->
<!--                                            <li>武松: 稳住！</li>-->
<!--                                            <li>金莲：？？</li>-->
<!--                                            <li>西门庆：不是我</li>-->
<!--                                        </ul>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->

                        </div>
                        <div class="layui-tab-item">

                        </div>

                    </div>
                </div>
            </div>

        </div>
        <div class="layui-col-md4">
            121212
        </div>
    </div>

</body>

<script src="layui/jquery.js"></script>
<script src="layui/layui.js"></script>
<script src="layui/auth.js"></script>

<script>

    layui.use('element', function(){
        var element = layui.element;

        //…
    });

    let basicURL    = getBasicUrl();
    let token       = getToken();

    $(document).ready(() => {
        // 列表信息
        getShareList( 'friend' );
    });

    function getShareList( list_type ) {

        $.get(basicURL + `/share/getShareList?token=${token}&list_type=${list_type}`, function(data) {
            // let res = JSON.parse(data);
            let res = {};
            if (typeof data === 'string') {
                res = JSON.parse(data);
            } else {
                res = data
            }

            getData = res['data'] != null ? res['data'] : null;
            if (getData != null) {

                list = getData['list'];

                $("#friend_list").empty();
                list.forEach((item) => {
                    console.log(item);
                    var shareTime   = new Date(parseInt(item['create_time']) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ');

                    // 点赞信息
                    var upList      = item['up_account'];
                    var upListHtml = ''
                    upList.forEach((item) => {
                        if ( upListHtml.length > 0 ){
                            item['nickname'] = "，" + item['nickname'] ;
                        }
                        upListHtml += '<li>'+ item['nickname'] +'</li>';
                    });
                    if ( upListHtml !== '' ){
                        upListHtml = '<i class="layui-icon layui-icon-heart-fill up_list_icon"></i>' + upListHtml
                    }

                    // 评论信息
                    var commentList     = item['comment_list'];
                    var commentListHtml = ''
                    commentList.forEach((item) => {
                        commentListHtml += '<li>'+ item['user_info']['nickname'] + ':' + item['comment_info'] +'</li>';
                    });

                    $("#friend_list").append(
                        '                            <div class="layui-col-md12 item">' +
                        '                                <div class="layui-col-md1 head_div">' +
                        '                                    <img src="'+item['share_user_info']['icon']+'" class="head">' +
                        '                                </div>' +
                        '                                <div class="layui-col-md6 nickname_div">' +
                        '                                    <span>'+item['share_user_info']['nickname']+'</span>' +
                        '                                </div>' +
                        '                                <div class="layui-col-md6 info_div">' +
                        '                                    <span>'+item['info']+'</span>' +
                        '                                </div>' +
                        '                                <div class="layui-col-md5 layui-col-md-offset1 img_group_div">' +
                        '                                    <div class="layui-col-md10">' +
                        '                                        <img src="'+item['url']+'" class="img">' +
                        '                                    </div>' +
                        '                                    <div class="up_comment">' +
                        '                                        <div class="layui-icon layui-icon-praise up" value = "'+ item['share_key'] +'" onclick="up( this )"></div>' +
                        '                                        <div class="layui-icon layui-icon-reply-fill comment"></div>' +
                        '                                    </div>' +
                        '                                </div>' +
                        '                                <div class="layui-col-md11 layui-col-md-offset1 time">' +
                        '                                    '+shareTime+'' +
                        '                                </div>' +
                        '                                <div class="layui-col-md6 layui-col-md-offset1 layui-bg-gray up_list">' +
                        '                                    <ul>' +
                                                            upListHtml+
                        '                                    </ul>' +
                        '                                </div>' +
                        '                                <div class="layui-col-md6 layui-col-md-offset1 layui-bg-gray comment_list">' +
                        '                                    <div>' +
                        '                                        <ul>'  +
                                                        commentListHtml +
                        '                                        </ul>' +
                        '                                    </div>' +
                        '                                </div>' +
                        '                            </div>'
                    );

                });

            }

        });


    }

    function up( ele ) {

        let share_key = $(ele).attr('value');
        let data = {};
        data['token']       = token;
        data['share_key']   = share_key;

        $.post(basicURL + `/share/upShare`, data, function(data) {

            if(typeof data === 'string'){
                res = JSON.parse(data);
            }else{
                res = data
            }
            if(res.code === 10000){
                alert('点赞成功');
            }else {
                alert(res.msg);
            }

        });
        getShareList( 'friend' );
    }

</script>

</html>
